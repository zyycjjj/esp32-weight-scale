# 热敏打印机（Dapu）与 ESP-BOX 连接指南（TTL / RS232）

## 推荐方案：TTL 串口（优先）

ESP-BOX（ESP32-S3）GPIO 是 3.3V 逻辑电平，最适合接打印机的 TTL 串口口。

### 接线规则（按丝印）

在打印机接口板上，找到标有 `TTL` 的插座，并按丝印标注连接：

- 打印机 `TXD` → ESP-BOX `RX`
- 打印机 `RXD` → ESP-BOX `TX`
- 打印机 `GND` → ESP-BOX `GND`

### 已确认线序（5Pin TTL 线束颜色）

你当前这根 5Pin TTL 线束从左到右颜色与功能为：

- 红：`GND`
- 黄：`DTRD`
- 白：`RXD`
- 蓝：`TXD`
- 黑：`NC`

ESP-BOX 侧推荐接法（与本项目 HX711 的 `G39/G40` 不冲突）：

- 红(`GND`) → ESP-BOX `GND`
- 蓝(`TXD`) → ESP-BOX `G42`（RX）
- 白(`RXD`) → ESP-BOX `G41`（TX）
- 黄(`DTRD`) → 不接
- 黑(`NC`) → 不接

电源线（打印机的供电）请单独接打印机电源，不要从 ESP-BOX 3V3 取电。

### ESP-BOX 建议占用的引脚

当前项目中 HX711 已使用：

- `G39` / `G40`

因此建议打印机 UART 使用：

- ESP-BOX `TX`：`G41`
- ESP-BOX `RX`：`G42`
- `GND`：任意 `GND`

### 电源与电平注意事项

- 热敏打印头功耗较大，通常需要 5V/9V/12V 且更高电流能力；打印机务必使用独立电源。
- 打印机电源 `GND` 必须与 ESP-BOX `GND` 共地，否则串口通信会不稳定或完全不通。
- 如果打印机 TTL 是 5V 电平：
  - 打印机 `TXD(5V)` → ESP-BOX `RX(3.3V)` 建议加电平转换或分压
  - ESP-BOX `TX(3.3V)` → 打印机 `RXD(5V)` 多数情况下可识别，但不保证，最好同样做电平转换

## 备选方案：RS232（需要电平转换，不能直连）

RS232 不是 TTL 电平，不能直接接 ESP-BOX GPIO。若要走 RS232，请使用 `MAX3232`（3.3V 侧）模块：

- ESP-BOX `TX/RX/GND` ↔ MAX3232 的 TTL 侧
- MAX3232 的 RS232 侧 ↔ 打印机 `RS232` 插座的 `TXD/RXD/GND`

同样需要共地，并使用打印机独立电源供电。

## UART 参数（常见）

DP-EH40 说明书中关于默认波特率存在两处描述：

- 技术规格页写“默认 9600”
- 波特率设置章节写“8 → 115200（默认值）”

建议以打印机自测页打印出来的“当前波特率”为准。

说明书支持通过指令修改到 `9600/19200/38400/...` 等档位。

多数热敏打印机使用 8-N-1（8 数据位，无校验，1 停止位）。以实物说明书为准。

## 供电（DP-EH40 说明书）

说明书标注输入电压为 `5~9V`，正常工作电流 `1.8–2.2A`。热敏打印头瞬时电流较大，请选择电流裕量足够的电源，并注意共地。

## 指令（DP-EH40 说明书节选）

- 初始化：`1B 40`
- 打印自测页：`12 54`（说明书示例：`1B 40 12 54`）
- 回车并进纸一行：`0D 0A`
